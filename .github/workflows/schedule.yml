# ğŸŒ¤ï¸ TÃªn cá»§a workflow â€” hiá»ƒn thá»‹ trong tab "Actions" cá»§a GitHub
name: ğŸŒ¤ï¸ Weather Data Crawl

on:
  # â° Thiáº¿t láº­p lá»‹ch cháº¡y tá»± Ä‘á»™ng báº±ng cron
  # á» Ä‘Ã¢y: "0 */2 * * *" nghÄ©a lÃ  cháº¡y má»—i 2 giá» (vÃ o phÃºt 0)
  schedule:
    - cron: "0 */2 * * *"

  # ğŸ‘‡ Cho phÃ©p báº¡n cháº¡y thá»§ cÃ´ng tá»« tab "Actions" trÃªn GitHub náº¿u cáº§n
  workflow_dispatch:

jobs:
  crawl:
    # ğŸ–¥ï¸ Cháº¡y trÃªn mÃ¡y áº£o Ubuntu má»›i nháº¥t
    runs-on: ubuntu-latest

    steps:
      # ğŸ§© BÆ°á»›c 1: Láº¥y toÃ n bá»™ code trong repository vá» mÃ¡y áº£o
      - name: Checkout code
        uses: actions/checkout@v4

      # ğŸ BÆ°á»›c 2: CÃ i Ä‘áº·t mÃ´i trÆ°á»ng Python (á»Ÿ Ä‘Ã¢y lÃ  phiÃªn báº£n 3.10)
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      # ğŸ“¦ BÆ°á»›c 3: CÃ i Ä‘áº·t cÃ¡c thÆ° viá»‡n cáº§n thiáº¿t tá»« file requirements.txt
      # (náº¿u báº¡n cÃ³ file nÃ y, vÃ­ dá»¥ chá»©a requests, pandas, v.v.)
      - name: Install dependencies
        run: pip install -r requirements.txt

      # â˜ï¸ BÆ°á»›c 4: Cháº¡y file Python crawl dá»¯ liá»‡u thá»i tiáº¿t vÃ  cháº¥t lÆ°á»£ng khÃ´ng khÃ­
      - name: Run crawl script
        run: python weather_air_quality.py
        env:
          # ğŸ”‘ Truyá»n biáº¿n mÃ´i trÆ°á»ng (API Key) tá»« GitHub Secrets
          # GiÃ¡ trá»‹ nÃ y KHÃ”NG hiá»ƒn thá»‹ cÃ´ng khai â€” an toÃ n cho API key cá»§a báº¡n
          OPENWEATHER_API_KEY: ${{ secrets.OPENWEATHER_API_KEY }}

      # ğŸ“¤ BÆ°á»›c 5: Upload file CSV (artifact) sau khi crawl xong
      - name: Upload daily weather data
        uses: actions/upload-artifact@v4
        with:
          # ğŸ·ï¸ Äáº·t tÃªn cho artifact, cÃ³ thÃªm ID cá»§a láº§n cháº¡y Ä‘á»ƒ trÃ¡nh trÃ¹ng
          name: weather-data-${{ github.run_id }}
          
          # ğŸ“‚ ÄÆ°á»ng dáº«n file CSV cáº§n upload (file theo tá»«ng ngÃ y)
          path: weather_air_quality_*.csv

    
